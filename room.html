<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="Expires" content="-1">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Pragma" content="no-cache">
<meta name="full-screen" content="yes">
<meta name="browsermode" content="application">
<meta name="x5-fullscreen" content="true">
<meta name="x5-page-mode" content="app">
<script type="text/javascript" src="js/flexible.js"></script>
<title>选择房号</title>
<link rel="stylesheet" href="css/style.css">
<style type="text/css">
	html {
		height: 100%;
		background: #f2f2f2;
	}
	.unitRefresh {
		display: inline-block;
		margin: 0 0 0 0.32rem;
		padding: 0 0.12rem 0 0.6rem;
		line-height: 0.59rem;
		height: 0.59rem;
		background: #fff url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAeCAYAAABE4bxTAAADA0lEQVRYhcXYW4jUVRwH8M/MLrosK5UilT1IJeuD+uAlEPNFH7xVWgalhKkgiLco88kMAq8gViQS20uBUEQ3EzFDCrqwoKKIoKioaRRrYEGmYqbWw++M83eanZ1xd8Yv/Dn/c/5nzvnu9/xuZ3MdHR1qRBMmYhrGYzjuRx5/oQuH8T124VwtizfXMLcVS7EcQ7uZMyA97XgOW/E1NuG7viQ0C9vwUGbsKg7gKH7FP4nMIxibSOWEktPwOZbhfG8INeMtoUoBnYncl7hc4bfDsABLMBCzMQFzVFArX2HBfvgiQ+Y8nsXj+LAHMnAKa4RiW3ETD2APptdKKIcP8GTqf4sRQvZa8SdewlO4iBbsEH9Y1YRewdz0vgMz8McdkMliNyZhr/DAxcqYTDkbasf69L4fz+NaL8kUcAhTKk0op9A6IesVoVJfkakKpYSGCcOFLTjTSDL8n9C8NHYV7zRg/1aMqkRoZmp34UIDCG3DTtxXGGjGw8LNWxTZHhbx4zJ+qxOZBekhQszT+Dcv8tNpkQKa0oR1OCk8rh4YKdQpYCZeJY5stUgHpXgdP9SBTBs+EfaTxQZMzIukOBe/Zz7uERm6Hhgn8mBWoU/xJkbnMvXQDGHMv2CM+hv1YyLwFkge5PZIvRsbU9sIDxuT2hvCXpUSgtcaQKSAqak9IipNVC4/6onBwkQIe7qFu0VoJfrjOt7Pfig9sibFevlvUZr2Ndrxcnr/CD9nP5YqdAPviUB5TvGc+wqtotpswSVRUd6Gcke2SFR5TfhY0Rt6i35pvbGpv0qJOt0ROosXhVr34Bs9FFVVYBC+UiyJ30XZC2F3Rr0TC0UUvzcttlmE/VoxW7j25NTfjhXdTa7kZdvxhKil80Lin7AWj/ZAog0vYB8+wxBx63gD84X6ZZGr4ir9oJB4Vsn4CVEjnxGBrVlcJEeJtNA/M/eYKOp/7Gmzam6uXaJWmSAi+VRh8MPTUwmH8LZw7+tV7FXT3b5THOFgPCP+4TAi9dvShl0iL3UKuztew/rgP9aRm/n6ynxXAAAAAElFTkSuQmCC') no-repeat 0.1rem center;
		background-size: 0.48rem 0.4rem;
		border: thin solid #e5e5e5;
		color: #999;
		border-radius: 0.05333333rem;
	}
</style>
</head>
<body style="background: #F2F2F2;">
	<div class="pos-fix">
	    <div class="msg-bg3">
	    	<p class=""><i class="icon-horn"></i>模拟选房为虚拟房源信息，拍下无效</p>
	    </div>
		<ul class="main main-4">
	        <li><a href="">24栋</a></li>
	        <li><a href="">23栋</a></li>
	        <li class="active"><a href="">22栋</a></li>
	        <li><a href="">21栋</a></li>
	        <li><a href="">20栋</a></li>
	        <li><a href="">19栋</a></li>
	    </ul>
		<div class="bg3">
			<div class="pos-rel">
				<p class="head">
					<a href="#" class="unit active">1单元</a>
					<a href="#" class="unit">2单元</a>
				</p>
				<p class="foot">
					<span class="title">状态<i class="green">可选</i><i class="red">已售</i><i class="gray">交易中</i></span>
					<span class="title fr unitRefresh">
						刷新
					</span>
					<span class="title fr">
						只看可选
						<!--开关-->
						<input type="checkbox" name="see" id="on_off" class="chooseBtn" />
						<label for="on_off" class="choose-label"></label>
					</span>
				</p>
			</div>
		</div>
	</div>
	<div class="main main-5 clearFix pos-rel">
		<div class="l">
			<p> 
            	<span>5</br>层</span>
            </p>
            <p> 
            	<span>4</br>层</span>
            </p>
            <p>
            	<span>3</br>层</span>
            </p>
            <p>
            	<span>2</br>层</span>
            </p>
            <p>
            	<span>1</br>层</span>
            </p>
        </div>
		<div class="r not-4" id="Room">
			<ul>
                <li class="state-green" data-id="1">
                	<div class="room-num">501</div>
                	<div class="room-sales">
            			<span>110㎡</span>
            			<span>110.23万</span>
                	</div>
                </li>
                <li class="state-gray">
                	<div class="room-num">502</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">503</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-green" data-id="2">
                	<div class="room-num">504</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
            </ul>
			<ul>
                <li class="state-green" data-id="3">
                	<div class="room-num">401</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-gray">
                	<div class="room-num">402</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-green" data-id="4">
                	<div class="room-num">403</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">404</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">404</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
            </ul>
            <ul>
                <li class="state-red">
                	<div class="room-num">301</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-green" data-id="5">
                	<div class="room-num">302</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-green" data-id="6">
                	<div class="room-num">303</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-gray">
                	<div class="room-num">304</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
            </ul>
            <ul>
                <li class="state-gray">
                	<div class="room-num">201</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">202</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">203</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-gray">
                	<div class="room-num">204</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
            </ul>
            <ul>
                <li class="state-green" data-id="7">
                	<div class="room-num">101</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-red">
                	<div class="room-num">102</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-gray">
                	<div class="room-num">103</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
                <li class="state-green" data-id="8" data-singerPrice="100元/㎡" data-collect="2人" data-roomStyle="一室两厅" data-title="某栋的几单元房间号" data-area="多少多少㎡" data-href="xiangxidizhi.html">
                	<div class="room-num">104</div>
                	<div class="room-sales">
                		<span>110㎡</span>
                		<span>110.23万</span>
                	</div>
                </li>
            </ul>
		</div>
	</div>
	<div class="bottom"></div>
	<div class="fixed-bottom tab-bar tab-bar2">
		<a href="index.html">
			<span>首页</span>
		</a>
		<a href="javascript:;" class="active">
			<span>选房</span>
		</a>
		<a href="collect.html">
			<span>收藏</span>
		</a>
		<a href="my.html">
			<span>我的</span>
		</a>
   	</div>
   	<div class="weui-mask"></div>
   	<div class="modal" id="slideModal">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <span class="close"></span>
	                <h4 class="modal-title">0栋0单元-000</h4>
	            </div>
	            <div class="modal-body">
	                <div class="form-content clearFix">
	                	<div class="fl">
	                		<p>房源总价：<span class="all_price">00.00万元</span></p>
	                		<p>建筑面积：<span class="area">0㎡</span></p>
	                		<p>该房源已有<i class="collect">0人</i>收藏</p>
	                	</div>
	                	<div class="fl">
	                		<p>单价：<span class="singer_price">0.00元/㎡</span></p>
	                		<p>户型结构：<span class="shape"></span</p>
	                		<p><a href="#" class="link pos-rel">点击了解房源详情</a></p>
	                	</div>
	                </div>
                    <div class="form-btn clearFix">
                    	<a href="javascript:;" id="collection" data-type="2" class="fl active"><i class="icon-star"></i><span>已收藏</span></a>
                        <a href="javascript:;" class="btn btn-submit disabled fl pos-rel" id="addCustomer" data-click="1">
                        	<div class="center">
	                        	<span class="nowSelect">立即选房</span>
	                        	<p class=""><em class="time_inner">距离模拟选房开始</em>：<span id="date_day">0</span>天<span id="date_hour">0</span>时<span id="date_minute">0</span>分<span id="date_second">0</span>秒</p>
                        	</div>
                        </a>
                    </div>
	            </div>
	        </div>
	    </div>
	</div>
	<div class="confirm-wrap toast-floor">
		<div class="confirm">
			<div class="buy_info">
				<p>房源名称：<span class="">*栋*单元-****</span></p>
	    		<p>房源总价：<span class="">**.**万元</span></p>
	    		<p>建筑面积：<span class="">***.**㎡</span></p>
			</div>
			<div class="buyer_info">
				<p>购房者：<i class="">王二蛋</i></p>
	    		<p>手机号：<i class="">177****9972</i></p>
				<!-- <p>身份证号：<i class="">3401**********0572</i></p> -->
			</div>
			<div class="confirm_btn clearFix">
				<a href="javascript:;" class="cancel fl">返回重选</a>
				<a href="javascript:;" class="assign fr" data-click="1" >确认选房</a>
			</div>
		</div>
	</div>
	<div class="success-wrap toast-floor">
		<div class="success">
			<p class="center">您已经成功选定<span>某栋住宅</span>，请您按新安房产网通知的时间地点，携有效身份证件办理相关手续</p>
			<a href="myroom.html">查看我的房源</a>
		</div>
	</div>
	<div class="fail-wrap toast-floor">
		<div class="fail">
			<p>该房源已售出，请选择其他房源</p>
			<a href="javascript:;" onClick="refresh()">确定</a>
		</div>
	</div>
	<div class="toast" style="display: none">
	    <div class="toast-block">
	        <span>提示内容</span>
	    </div>
	</div>
   	<!-- <div class="refresh" onClick="refresh()"></div> -->
	<script type="text/javascript" src="js/zepto.min.js"></script>
	<script type="text/javascript" src="js/mock.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			if($('.msg-bg3').length == '0'){
				if($('.head').length == '0') {
					$('.foot').css('padding-top','0.48rem')
					$('.main-5').css('padding-top','2.76rem')
				} else {
					$('.main-5').css('padding-top','3.72rem')
				}
			} else if($('.head').length == '0') {
				$('.foot').css('padding-top','0.48rem')
				$('.main-5').css('padding-top','3.64rem')
			}
			
			//是否只看可选
			var _href = window.location.href;
			if(_href.substr(_href.length-3) == '/#1'){
				$('#on_off').prop('checked',true);
				$('#Room').find('ul .state-red').css('display','none');
				$('#Room').find('ul .state-gray').css('display','none');
				//console.log($('#Room').find('ul'))
				$.each($('#Room').find('ul'), function(i,k) {
					//console.log(i,k.children)
					var is_none = true;
					$.each(k.children, function(is,ks) {
						//console.log(i,ks)
						if($(ks).css('display') != 'none'){
							is_none = false;
						}
					});
					//console.log(i,is_none)
					if(is_none){
						$('.l p').eq(i).css('display','none');
					}
				});
			} else {
				$('#on_off').prop('checked',false);
				$('#Room').find('ul .state-red').css('display','inline-block');
				$('#Room').find('ul .state-gray').css('display','inline-block');
				$.each($('.l p'), function(i,k) {
					$(k).css('display','block');
				});
			}
			
			var interval = 1000, // 定时器的执行时间
				count = 0, // 定时器执行次数
				startTime = new Date().getTime(); //当前页面的打开时间
				
			var now_time = new Date('2020/04/20 17:30:05').getTime();//当前时间
			var imitate_time_start = new Date('2020/04/20 17:30:10').getTime();//模拟开始时间
			var imitate_time_end = new Date('2020/04/20 17:30:20').getTime();//模拟结束时间
			var formal_time_start = new Date('2020/04/20 17:30:30').getTime();//正式开始时间
			var formal_time_end = new Date('2020/04/20 17:30:40').getTime();//正式结束时间
			
			var im_start = imitate_time_start - now_time, // 距离模拟选房开始的时间
				im_end = imitate_time_end - now_time, // 距离模拟选房结束的时间
				fo_start = formal_time_start - now_time, // 距离正式选房开始的时间
				fo_end = formal_time_end - now_time; // 距离正式选房结束的时间
			
			if(fo_end > 0) {
				// 选房没结束
				var timeCounter = setTimeout(countDownStart,interval);
			} else {
				// 选房结束
				console.log('选房结束！');
				$('#addCustomer').addClass('disabled');
				$('#addCustomer').find('p').hide();
				$('#addCustomer').find('.nowSelect').html('选房已结束');
			}
			
			// 倒计时逻辑
			function countDownStart(){
				// 开始执行的次数
				count++;
				var diff = new Date().getTime() - (startTime + count * interval);
				var nextTime = interval - diff;
				if (nextTime < 0) { nextTime = 0 };
				
				
				if(im_start > 0) {
					// 模拟选房未开始
					im_start -= interval;
					im_end -= interval;
					fo_start -= interval;
					fo_end -= interval;
					
					console.log("模拟选房开始倒计时剩余：" + im_start + "ms");
					$('.time_inner').html('距离模拟选房开始还剩');
					ShowCountDown(im_start);
					
					timeCounter = setTimeout(countDownStart,nextTime);
					
				} else if(im_start <= 0 && im_end > 0) {
					// 模拟选房开始
					im_end -= interval;
					fo_start -= interval;
					fo_end -= interval;
					
					console.log("模拟选房结束倒计时剩余：" + im_end + "ms");
					$('.time_inner').html('距离模拟选房结束');
					$('#addCustomer').removeClass('disabled');
					ShowCountDown(im_end);
					
					timeCounter = setTimeout(countDownStart,nextTime);
					
				} else if(im_end <= 0 && fo_start > 0) {
					// 模拟选房结束，正式选房未开始
					fo_start -= interval;
					fo_end -= interval;
					
					console.log("正式选房开始倒计时剩余：" + fo_start + "ms");
					$('.time_inner').html('距离正式选房开始');
					$('#addCustomer').addClass('disabled');
					ShowCountDown(fo_start);
					
					timeCounter = setTimeout(countDownStart,nextTime);
					
				} else if(fo_start <= 0 && fo_end > 0) {
					// 正式选房开始
					fo_end -= interval;
					
					console.log("正式选房结束倒计时剩余：" + fo_end + "ms");
					$('.time_inner').html('距离正式选房结束');
					$('#addCustomer').removeClass('disabled');
					$('#addCustomer').find('p').hide();
					ShowCountDown(fo_end);
					
					timeCounter = setTimeout(countDownStart,nextTime);
					
				} else if(fo_end <= 0) {
					// 选房结束
					console.log('选房结束！');
					ShowCountDown(fo_end);
					$('#addCustomer').addClass('disabled');
					$('#addCustomer').find('p').hide();
					$('#addCustomer').find('.nowSelect').html('选房已结束');
					
					clearTimeout(timeCounter);
				}
			}
			
			function ShowCountDown(times) {
			 	var time = parseInt(times / 1000);
			    var day = Math.floor(time / (60 * 60 * 24));
			    var hour = Math.floor((time - day * 24 * 60 * 60) / 3600);
			    var minute = Math.floor((time - day * 24 * 60 * 60 - hour * 3600) / 60);
			    var second = Math.floor(time - day * 24 * 60 * 60 - hour * 3600 - minute * 60);
			    
			   	$('#date_day').html(day);
			    $('#date_hour').html(hour);
			    $('#date_minute').html(minute);
			    $('#date_second').html(second);
			}
			
			document.addEventListener('visibilitychange',function() {
				if (document.visibilityState == 'visible') {
					window.location.reload(location.href+'?v='+Math.random());
				}
			});
		});
		
		function refresh(){
            var _href = window.location.href;
            if($('#on_off').get(0).checked) {
            	if(_href.substr(_href.length - 3) == '/#1') {
            		window.location.reload(location.href+'?v='+Math.random());
            	} else if (_href.substr(_href.length - 3) == '/#2'){
            		window.location.href = _href.substring(0,_href.length - 3) + '/#1';
            	} else {
            		window.location.reload(location.href+'?v='+Math.random());
            	}
            } else {
            	if(_href.substr(_href.length - 3) == '	') {
            		window.location.reload(location.href+'?v='+Math.random());
            	} else if(_href.substr(_href.length - 3) == '/#1'){
            		window.location.href = _href.substring(0,_href.length - 3) + '/#2';
            	} else {
            		window.location.reload(location.href+'?v='+Math.random());
            	}
            }
       	}
		
		// 模拟信息接口
		var Random = Mock.Random;
		
		var glob = {};
		
		//刷新
		$('.unitRefresh').on('click',function(e){
			refresh();
		});
		
		//开关
		$('#on_off').on('change',function(e){
			e.preventDefault();
			e.stopPropagation();
			var _href = window.location.href;
			if(this.checked){
				if(_href.substr(_href.length - 3) == '/#1') {
					window.location.reload();
				} else if (_href.substr(_href.length - 3) == '/#2'){
					window.location.href = _href.substring(0,_href.length - 3) + '/#1';
				} else {
					window.location.href = _href + '/#1';
				}
				
				// $('#Room').find('ul .state-red').css('display','none');
				// $('#Room').find('ul .state-gray').css('display','none');
				$('#Room').find('ul .state-red').fadeOut();
				$('#Room').find('ul .state-gray').fadeOut();
				
				$.each($('#Room').find('ul'), function(i,k) {
					var is_none = true;
					$.each(k.children, function(is,ks) {
						if($(ks).css('opacity') == 1 ){
						// fadeIn有延迟效果，获取display状态不准确
						// if($(ks).css('display') != 'none'){
							is_none = false;
						}
					});
					if(is_none){
						// $('.l p').eq(i).css('display','none');
						$('.l p').eq(i).fadeOut();
					}
				});
			} else {
				if(_href.substr(_href.length - 3) == '/#2') {
					window.location.reload();
				} else if(_href.substr(_href.length - 3) == '/#1'){
					window.location.href = _href.substring(0,_href.length - 3) + '/#2';
				} else {
					window.location.href = _href + '/#2';
				}
				
				// $('#Room').find('ul .state-red').css('display','inline-block');
				// $('#Room').find('ul .state-gray').css('display','inline-block');
				$('#Room').find('ul .state-red').fadeIn();
				$('#Room').find('ul .state-gray').fadeIn();
				
				$.each($('.l p'), function(i,k) {
					// $(k).css('display','block');
					$(k).fadeIn();
				});
			}
		});
		
		//如果点了已售的~~
		$('#Room').on('click','li.state-red',function(){
			$('.fail p').html('该房源已售出，请选择其他房源');
			showSelect('.fail');
		});
		
		// 模拟信息接口
		Mock.mock('selectroom?room_id=1',{
			"code": 200,
			"data": {
				'id|+1': 1,
				'shape': Random.natural(1, 5) +'房'+ Random.natural(1, 2) +'厅'+ Random.natural(1, 5) +'卫',
				'title': Random.natural(1, 5) +'栋'+ Random.natural(1, 5) +'号'+ Random.natural(100, 500) +'室',
				'total_price|120-1700.2': 0,
				'area|50-360.2': 0,
				'collection_num|0-100': 0,
				'price|8000-40000.2': 0,
				'structure_name': '@shape',
				'is_collection': Random.boolean(1,3,true)
			}
		});
		Mock.mock('selectroom?room_id=2',{
			"code": 500,
			"msg": "淦！手快有，手慢无，卖掉了啦！"
		});
		Mock.mock('selectroom?room_id=3',{
			"code": 400,
			"msg": "你来晚了，买房时间结束了~"
		});
		//开启底部弹窗
		$('#Room').on('click','li.state-green',function(){
			clearInterval(glob.autoRefresh);
			
			if($(this).hasClass('state-red')) {
				$('#addCustomer').addClass('disabled');
				$('#addCustomer').find('p').hide();
			    $('#addCustomer').find('.nowSelect').html('该房源已售出');
			}
			
			$.ajax({
				// 用mock模拟不同结果无法随机判断某个结果是返回正确或错误，只能使用笨办法
				// 写几个不同的ajax请求也不靠谱，所以这里使用get请求，根据传的参数来判断（地址后缀不一样）
				// 原来的模式应该是post，但post不带后缀，没法使用
				// id为1时，楼盘状态正确，未售出；2，确认时已售出；3，选房时间已截止；其他：你网断了；
				// type:"post",
				type:"get",
				url:"selectroom",
				async:true,
				dataType: 'json',
				data: {room_id: $(this).attr('data-id')},
				success: function(res){
					if(res.code == "200") {
						console.log(res.data)
						var _data = res.data;
						
						$('.modal').find('.modal-title').html( _data.title );
						$('.modal').find('.all_price').html( _data.total_price + '万元' );
						$('.modal').find('.area').html( _data.area + '㎡' );
						$('.modal').find('.collect').html( _data.collection_num + '人' );
						$('.modal').find('.singer_price').html( _data.price + ' 元/㎡' );
						$('.modal').find('.shape').html( _data.structure_name );
						// $('.modal').find('.link').attr('href',"?room_id="+_data.id);
						$('.modal').find('.link').attr('href','details.html');
						$('.modal').find('#addCustomer').attr('data-id',_data.id);
						
						//是否收藏
						if(_data.is_collection == '0') {
							$('.modal').find('#collection').removeClass('active').attr({'data-id': _data.id,'data-type':1}).find('span').html('收藏')
						} else {
							$('.modal').find('#collection').addClass('active').attr({'data-id': _data.id,'data-type':2}).find('span').html('已收藏')
						}
						
						//弹出
				        $('.weui-mask').addClass('weui-animate-fade-in').removeClass('weui-animate-fade-out').show();
				        $('#slideModal').removeClass('weui-animate-slide-down').addClass('weui-animate-slide-up').show();
					} else if(res.code == "500"){
						//console.log(res)
						$('.fail p').html(res.msg);
						showSelect('.fail')
					} else {
						showToast(res.msg);
					}
					
				},
				error: function(res){
					showToast('网络请求失败,请重试');
				}
			});
			//弹出
            // $('.weui-mask').addClass('weui-animate-fade-in').removeClass('weui-animate-fade-out').show();
            // $('#slideModal').removeClass('weui-animate-slide-down').addClass('weui-animate-slide-up').show();
        });
		
		//关闭底部弹窗
		$(document.body).on('click', '.modal-header .close', function () {
            refresh();
			$('.weui-mask').removeClass('weui-animate-fade-in').addClass('weui-animate-fade-out').fadeOut('fast');
            $('#slideModal').removeClass('weui-animate-slide-up').addClass('weui-animate-slide-down').fadeOut('fast');
       	});
		//冲突的关闭弹层
		$(document.body).on('click', '.weui-mask', function () {
			refresh();
		    $('.weui-mask').removeClass('weui-animate-fade-in').addClass('weui-animate-fade-out').fadeOut('fast');
		    $('#slideModal').removeClass('weui-animate-slide-up').addClass('weui-animate-slide-down').fadeOut('fast');
		});
		
		// 模拟信息接口
		Mock.mock('selectroom/collection?room_id=1&type=1',{
			"code": 200,
			"msg": "收藏成功！"
		});
		Mock.mock('selectroom/collection?room_id=1&type=2',{
			"code": 200,
			"msg": "取消收藏成功！"
		});
		
		//收藏的逻辑
		$(document.body).on('click','#collection',function(){
			
			var _this = $(this);
			
			$.ajax({
				// type:"post",
				type:"get",
				url:"selectroom/collection",
				async:true,
				dataType: 'json',
				data: {room_id: _this.attr('data-id'),type:_this.attr('data-type')},
				success: function(res){
					if(res.code == '200') {
						var _num = $('.collect').html().substring(0,$('.collect').html().length-1);
						if( _this.attr('data-type') == 1) {
							_this.attr('data-type',2).addClass('active').find('span').html('已收藏');
							$('.collect').html( (Number(_num)+1) + '人' );
						} else {
							_this.attr('data-type',1).removeClass('active').find('span').html('收藏');
							$('.collect').html( (Number(_num)-1) + '人' );
						}
						showToast(res.msg);
					} else {
						showToast(res.msg);
					}
				},
				error: function(res){
					showToast('网络请求失败,请重试');
				}
			})
		});
		
		// 模拟信息接口
		Mock.mock('selectroom/verification?room_id=1',{
			"data|1": {
				data: {
					"code": 200,
					"msg": "选房成功！"
				},
				data1: {
					"code": 400,
					"msg": "手速太慢了，没抢到！"
				},
				data2: {
					"code": 500,
					"msg": "哦吼，时间到了，完犊子了~"
				}
			}
		});
		
		//立即选房的逻辑
		$(document.body).on('click','#addCustomer',function(){
			var $this = $(this);
			if($this.hasClass('disabled')) {
				return;
			}
			//重复提交
			if($this.attr('data-click') != '1') {
				return;
			}
			
			$this.attr('data-click',2);
			
			var _price = $this.parents('#slideModal').find('.all_price').html(),
				_house = $this.parents('#slideModal').find('.modal-title').html(),
				_area = $this.parents('#slideModal').find('.area').html(),
				_id = $this.attr('data-id');
	
			$.ajax({
				// type:"post",
				type: 'get',
				url:"selectroom/verification",
				async:true,
				dataType:'json',
				data:{room_id: _id},
				success: function(res){
					if(res.data.data && res.data.data.code == '200') {
					// if(res.code == '200') {
						$('.confirm-wrap').find('.buy_info p').eq(0).find('span').html(_house);
						$('.confirm-wrap').find('.buy_info p').eq(1).find('span').html(_price);
						$('.confirm-wrap').find('.buy_info p').eq(2).find('span').html(_area);
						$('.confirm-wrap').find('.assign').attr('data-id',_id);
	
						//关闭前一个遮罩弹层
						$('.weui-mask').removeClass('weui-animate-fade-in').addClass('weui-animate-fade-out').fadeOut('fast');
						$('#slideModal').removeClass('weui-animate-slide-up').addClass('weui-animate-slide-down').fadeOut('fast');
						//开启弹窗
						showSelect('.confirm');
	
						$this.attr('data-click',1);
					} else if(res.data.data1 && res.data.data1.code == '400' ){
					//} else if(res.code == '400'){
						//关闭前一个遮罩弹层
						$('.weui-mask').removeClass('weui-animate-fade-in').addClass('weui-animate-fade-out').fadeOut('fast');
						$('#slideModal').removeClass('weui-animate-slide-up').addClass('weui-animate-slide-down').fadeOut('fast');
						//开启弹窗
						
						// $('.fail p').html(res.msg);
						$('.fail p').html(res.data.data1.msg);
						
						showSelect('.fail');
						$this.attr('data-click',1);
					} else {
						// showToast(res.msg);
						showToast(res.data.data2.msg);
						$this.attr('data-click',1);
						
						//关闭遮罩弹层
						$('.weui-mask').removeClass('weui-animate-fade-in').addClass('weui-animate-fade-out').fadeOut('fast');
						$('#slideModal').removeClass('weui-animate-slide-up').addClass('weui-animate-slide-down').fadeOut('fast');
						setTimeout(refresh,1000);
					}
				},
				error: function(res){
					showToast('网络请求失败,请重试');
					$this.attr('data-click',1);
				}
			})
			
			$(document.body).on('click','.cancel',function(){
				cancelSelect('.confirm')
				setTimeout(refresh,200)
			})
		});
		
		// 模拟信息接口
		Mock.mock('selectroom/roomselect?room_id=1',{
			"code": 200,
			"msg": "选房成功！",
			"data": Random.natural(1, 5) +'栋'+ Random.natural(1, 5) +'号'+ Random.natural(100, 500) +'室'
		});
		$(document.body).on('click','.assign',function(){
			var _this = $(this);
			
			//重复提交
			var _click = _this.attr('data-click');
			if(_click != '1') {
				return;
			}
			
			$(this).attr('data-click',2);
			
			$.ajax({
				type:"get",
				url:"selectroom/roomselect",
				async:true,
				dataType: 'json',
				data:{room_id:$(this).attr('data-id')},
				success: function(res){
					cancelSelect('.confirm');
					if(res.code == '200') {
						$('.success-wrap').find('span').html(res.data);
						showSelect('.success');
						_this.attr('data-click',1);
					} else if(res.code == '400'){
						$('.fail p').html(res.msg);
						showSelect('.fail');
						_this.attr('data-click',1);
					} else {
						showToast(res.msg);
						_this.attr('data-click',1);
					}
				},
				error: function(res) {
					showToast('网络错误，请重试！')
					_this.attr('data-click',1);
				}
			});
		});
		
		
		function showToast(str,_timer) {
			var str = str || '这是错误提示',
				_timer = _timer || 1000; 
			$('.toast').fadeIn();
			$('.toast span').html(str);
			$('.toast .toast-block').animate({
				'opacity':1,
				'top': '45%'
			});
			setTimeout(function(){
				$('.toast .toast-block').animate({
					'opacity':0,
					'top': '40%'
				},function(){
					$('.toast').fadeOut(200);
				});
			},_timer);
		}//消息提示框
		function showSelect(content) {
			$(content+'-wrap').fadeIn();
			$(content).animate({
				'opacity':1,
				'top': '50%'
			});
		}//动画弹出
		function cancelSelect(content) {
			$(content+'-wrap').fadeOut();
			$(content).animate({
				'opacity':0,
				'top': '40%'
			});
		}//动画弹出
		
		//每60秒自动刷新
		glob.autoRefresh = setInterval(refresh,30000);
	</script>
</body>
</html>
